% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/group-age.R
\name{group_age}
\alias{group_age}
\title{Categorize Age Variable into Groups}
\usage{
group_age(
  dt,
  var,
  breaks,
  labels = NULL,
  new_var = NULL,
  right = FALSE,
  include.lowest = TRUE,
  validate = TRUE,
  copy = FALSE,
  missing_values = NULL
)
}
\arguments{
\item{dt}{data.table. The input data.table object containing the age variable.}

\item{var}{Character string. Name of the age variable to be categorized.}

\item{breaks}{Numeric vector. Break points for age categories. Should include
the minimum value to ensure all ages are captured.}

\item{labels}{Character vector, optional. Labels for the age groups. If NULL,
default labels will be generated automatically. Length should be one less
than the number of breaks. Default is NULL.}

\item{new_var}{Character string, optional. Name of the new categorical variable
to be created. If NULL, defaults to "\if{html}{\out{<var>}}_group". Default is NULL.}

\item{right}{Logical. Should intervals be closed on the right (and open on the left)
or vice versa? Default is FALSE.}

\item{include.lowest}{Logical. Should the lowest break point be included in the
first interval? Default is TRUE.}

\item{validate}{Logical. Should input validation be performed? Default is TRUE.}

\item{copy}{Logical. Should a copy of the data.table be returned instead of
modifying in place? If TRUE then object name should have different name. Default is FALSE.}

\item{missing_values}{Numeric vector, optional. Values that should be treated
as missing (e.g., survey codes like 999 for "don't know", 998 for "no answer").
These values will be converted to NA before categorization. Default is NULL.}
}
\value{
The modified data.table with the new age group variable added. If copy=TRUE,
returns a new data.table; otherwise modifies the input data.table by reference.
}
\description{
This function creates age groups from a continuous age variable using specified
breaks and labels. It's designed to work with data.table objects and provides
flexible options for defining age categories commonly used in demographic analysis.
}
\details{
The function uses base R's \code{cut()} function internally to create the age categories.
Common age groupings in demographic analysis include:
\itemize{
\item Pediatric: 0-18 years
\item Young adult: 19-30 years
\item Middle age: 31-50 years
\item Older adult: 51+ years
}

The breaks vector should always include the minimum expected age (often 0) and
a maximum value that exceeds the highest age in your data.
}
\section{Missing Value Handling}{

Survey data often uses special numeric codes to represent different types of
missing responses:
\itemize{
\item 999: "Don't know"
\item 998: "Prefer not to answer"
\item 997: "Not applicable"
\item -1, -9: Various missing codes
}

The \code{missing_values} parameter allows you to specify these codes, which
will be converted to NA before age categorization. This ensures that survey
response codes don't interfere with legitimate age values and are properly
treated as missing data in the resulting age groups.

When validate=TRUE, the function checks for:
\itemize{
\item Existence of the specified age variable
\item Numeric age variable
\item Proper breaks vector (numeric, sorted, minimum length 2)
\item Matching labels length (if provided)
\item Coverage of all valid age values by the breaks (excluding missing codes)
\item Valid missing_values parameter (if provided)
}
}

\examples{
library(data.table)

# Create sample data
dt <- data.table(
  id = 1:100,
  age = sample(18:80, 100, replace = TRUE),
  gender = sample(c("M", "F"), 100, replace = TRUE)
)

# Basic usage with automatic labels
age_breaks <- c(0, 18, 30, 50, 100)
dt_grouped <- group_age(dt, "age", breaks = age_breaks, copy = TRUE)

# With custom labels
age_labels <- c("Youth", "Young Adult", "Middle Age", "Senior")
dt_custom <- group_age(dt, "age",
                       breaks = age_breaks,
                       labels = age_labels,
                       new_var = "age_category",
                       copy = TRUE)

# With missing value codes (common in surveys)
dt_survey <- data.table(
  id = 1:100,
  age = c(sample(18:80, 90, replace = TRUE), rep(999, 5), rep(998, 5))
)

# Handle survey missing codes
dt_clean <- group_age(dt_survey, "age",
                      breaks = c(0, 18, 30, 50, 100),
                      labels = c("Youth", "Young Adult", "Middle Age", "Senior"),
                      missing_values = c(998, 999),  # "no answer", "don't know"
                      copy = TRUE)

# Check the result
table(dt_clean$age_group, useNA = "ifany")

}
\seealso{
\code{\link[base]{cut}} for the underlying categorization function.
\code{\link[data.table]{data.table}} for data.table operations.
}
