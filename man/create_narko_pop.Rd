% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/narko-pop.R
\name{create_narko_pop}
\alias{create_narko_pop}
\title{Create Population Indicator Columns for LTP and LYP Analysis}
\usage{
create_narko_pop(data, ltp, lyp, narkvars)
}
\arguments{
\item{data}{A data.table containing the survey response data. Must include an 'ans1' column.}

\item{ltp}{Character vector of column names representing LTP question variables (e.g., ans2_x variables).}

\item{lyp}{Character vector of column names representing LYP question variables (e.g., ans3_x variables).}

\item{narkvars}{Character vector of drug/substance names corresponding to the question variables.
Used for naming the output columns.}
}
\value{
A data.table (copy of input) with additional binary indicator columns:
\itemize{
\item \code{ltpPop_<substance>}: 1 if respondent is in LTP population for that substance, 0 otherwise
\item \code{lypPop_<substance>}: 1 if respondent is in LYP population for that substance, 0 otherwise
}
}
\description{
This function creates binary population indicator columns for LTP (Lifetime Prevalence)
and LYP (Last Year Prevalence) based on response patterns in drug use survey data.
The population is defined by specific answer combinations across multiple question variables.
}
\details{
\subsection{Population Definition Logic}{

The population indicators are calculated based on the following rules:

\subsection{Core Population (applies to both LTP and LYP):}{
\itemize{
\item Rule 1: All respondents who answered 1 or 2 ie. Yes and No, in Ans1 are included
}
}

\subsection{LTP Population (ltpPop_*):}{
A respondent is coded as 1 (in population) if:
\itemize{
\item They answered 1 or 2 in the corresponding Ans2_x variable, OR
\item The Ans2_x variable is missing (NA) AND Ans1 is 2
}
Otherwise coded as 0 (not in population)
}

\subsection{LYP Population (lypPop_*):}{
A respondent is coded as 1 (in population) if:
\itemize{
\item They answered 1 or 2 in the corresponding Ans3_x variable, OR
\item The Ans3_x variable is missing (NA) AND Ans1 is 2
}
Otherwise coded as 0 (not in population)
}

\subsection{Exclusion Rule:}{
\itemize{
\item Missing values in ans2_x and ans3_x are excluded (coded as 0) if ans1 is NOT in \{1, 2\}
}
}
}
}
\note{
\itemize{
\item The function creates a copy of the input data to avoid modifying the original
\item Requires data.table package
\item The length of \code{ltp}, \code{lyp}, and \code{narkvars} should match
\item Column names are automatically generated as \code{ltpPop_<substance>} and \code{lypPop_<substance>}
}
}
\examples{
\dontrun{
library(data.table)

# Sample data
dt <- data.table(
  ans1 = c(1, 2, 3, 1, 2),
  ans2_cannabis = c(1, 2, 8, NA, 1),
  ans2_cocaine = c(2, NA, 9, 1, NA),
  ans3_cannabis = c(1, 2, NA, 1, 2),
  ans3_cocaine = c(NA, 1, 2, NA, 1)
)

# Create population indicators
result <- create_narko_pop(
  data = dt,
  ltp = c("ans2_cannabis", "ans2_cocaine"),
  lyp = c("ans3_cannabis", "ans3_cocaine"),
  narkvars = c("cannabis", "cocaine")
)

# Result includes ltpPop_cannabis, ltpPop_cocaine, lypPop_cannabis, lypPop_cocaine
}

}
\concept{population indicator functions}
